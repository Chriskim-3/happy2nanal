<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy2Nanal</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* CSS 스타일 */
        @font-face {
            font-family: 'GmarketSansMedium';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansMedium.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 0;
            font-size: 16px;
        }
        .header {
            background-color: #f0f0f0;
            padding: 20px;
            text-align: center;
            font-family: 'GmarketSansMedium';
        }
        .support-message {
            color: #006994;
            margin-bottom: 5px;
            font-size: 1.2em;
        }
        .main-title {
            color: #333;
            font-size: 1.8em;
            font-weight: bold;
        }
        .menu-bar {
            background-color: #333;
            overflow: visible;
            padding: 0 20px;
            position: relative;
            z-index: 1000;
        }
        .menu-bar a, .dropdown .dropbtn {
            float: left;
            color: white;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
            font-size: 14px;
            transition: 0.3s;
        }
        .dropdown {
            position: relative;
            display: inline-block;
        }
        .dropdown .dropbtn {
            border: none;
            outline: none;
            background-color: inherit;
            font-family: inherit;
            margin: 0;
        }
        .menu-bar a:hover, .dropdown:hover .dropbtn {
            background-color: #555;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            border-radius: 8px;
            background-color: rgba(249, 249, 249, 0.9);
            top: 100%;
            left: 0;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 10001;
        }
        .dropdown-content a {
            float: none;
            border-radius: 8px;
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            text-align: left;
        }
        .dropdown-content a:hover {
            background-color: #ddd;
        }
        .dropdown:hover .dropdown-content {
            display: block;
        }
        .content {
            margin: 20px;
            padding-bottom: 60px;
            position: relative;
            z-index: 1;
        }
        .main {
            padding: 20px;
        }
        .footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 6px;
            position: fixed;
            bottom: 0;
            width: 100%;
            font-size: 0.8em;
            font-family: 'Google Sans', sans-serif;
            z-index: 1000; /* 다른 요소보다 높게 설정 */
        }
        .search-bar {
            display: inline-block;
        }
        #editor, #editEditor, #studyContent, #noticeContent, #fileContent {
            width: 100%;
            height: 300px;
            margin-bottom: 10px;
            padding: 10px;
            box-sizing: border-box;
        }
        #postList, #noticeList, #studyList, #fileList {
            list-style-type: none;
            padding: 0;
        }
        #postList li, #noticeList li, #studyList li, #fileList li {
            cursor: pointer;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        #postList li:hover, #noticeList li:hover, #studyList li:hover, #fileList li:hover {
            background-color: #f5f5f5;
        }
        .button-container {
            text-align: center;
            margin-top: 20px;
        }
        .button-container button {
            margin: 0 5px;
            padding: 10px 20px;
        }
        h2 {
            font-size: 1.1em;
        }
        h3 {
            font-size: 1.2em;
            margin-top: 10px;
        }
        #studyTitle, #noticeTitle, #postTitle, #fileTitle {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        .date-display {
            color: #888;
            font-size: 0.9em;
            text-align: right;
            margin-bottom: 10px;
        }
        .study-title {
            text-align: center;
            background-color: #f0f0f0;
            padding: 10px;
            margin-bottom: 20px;
        }
        .search-container {
            text-align: center;
            margin: 20px 0;
        }
        .intro-image {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px auto;
        }
        .file-download {
            text-align: center;
            margin-bottom: 20px;
        }
        .file-download a {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }
    </style>
    <!-- Firebase Configuration -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBtyjw-rPmCLoXK7O471upPawvJmp6jaWA",
            authDomain: "nanal-9e758.firebaseapp.com",
            projectId: "nanal-9e758",
            storageBucket: "nanal-9e758.appspot.com",
            messagingSenderId: "1073199749734",
            appId: "1:1073199749734:web:372da8e47d7366e1242ba7",
            measurementId: "G-L20RGTW4TC"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const analytics = firebase.getAnalytics(app);
        const database = firebase.database();

        // 뒤로 가기 기능
        document.addEventListener('keydown', function(event) {
            if (event.key === "Backspace" && !event.target.matches('input, textarea')) {
                event.preventDefault();
                window.history.back();
            }
        });

        function showContent(content) {
            let html = `<p>${content}</p>`;
            if (content === '이 홈페이지는 글쓰고, 올리고, 지울려고 만드는 사이트 입니다.') {
                html += '<img src="https://apod.nasa.gov/apod/image/2407/CometaryGlobs_Pugh_1080.jpg" alt="소개 이미지" class="intro-image">';
            }
            document.getElementById('mainContent').innerHTML = html;
        }
    
        function showStudyList(topic) {
            let listHtml = `<h2 class="study-title">${topic} 학습 내용</h2>`;
            
            listHtml += '<ul id="studyList">';
            studyContents.filter(item => item.topic === topic).forEach((item, index) => {
                listHtml += `
                    <li onclick="viewStudyContent(${studyContents.indexOf(item)})">
                        <h3>${item.title}</h3>
                        <div class="date-display">${item.date || '날짜 없음'}</div>
                    </li>`;
            });
            listHtml += '</ul>';
    
            listHtml += `
                <div class="search-container">
                    <input type="text" id="studySearchInput" placeholder="검색...">
                    <button onclick="searchStudy('${topic}')">검색</button>
                </div>
                <div class="button-container">
                    <button onclick="showStudyForm('${topic}')">글쓰기</button>
                </div>
            `;
    
            document.getElementById('mainContent').innerHTML = listHtml;
        }
    
        function showStudyForm(topic) {
            document.getElementById('mainContent').innerHTML = `
                <h3>${topic} 내용 추가</h3>
                <input type="text" id="studyTitle" placeholder="제목을 입력하세요">
                <textarea id="studyContent" placeholder="내용을 입력하세요..."></textarea>
                <div class="button-container">
                    <button onclick="saveStudyContent('${topic}')">저장</button>
                </div>
            `;
        }
    
        function saveStudyContent(topic) {
            const title = document.getElementById('studyTitle').value;
            const content = document.getElementById('studyContent').value;
            if (title && content) {
                const date = new Date().toLocaleString();
                studyContents.push({topic, title, content, date});
                localStorage.setItem('studyContents', JSON.stringify(studyContents));
                showStudyList(topic);
            }
        }
    
        function viewStudyContent(index) {
            const item = studyContents[index];
            let content = `
                <h2>${item.title}</h2>
                <div class="date-display">${item.date || '날짜 없음'}</div>
                <div>${item.content}</div>
                <div class="button-container">
                    <button onclick="editStudyContent(${index})">수정</button>
                    <button onclick="deleteStudyContent(${index})">삭제</button>
                    <button onclick="showStudyList('${item.topic}')">목록으로</button>
                </div>
            `;
            document.getElementById('mainContent').innerHTML = content;
        }
    
        function editStudyContent(index) {
            const item = studyContents[index];
            document.getElementById('mainContent').innerHTML = `
                <h3>학습 내용 수정</h3>
                <input type="text" id="studyTitle" value="${item.title}">
                <textarea id="studyContent">${item.content}</textarea>
                <div class="button-container">
                    <button onclick="updateStudyContent(${index})">업데이트</button>
                    <button onclick="showStudyList('${item.topic}')">취소</button>
                </div>
            `;
        }
    
        function updateStudyContent(index) {
            const title = document.getElementById('studyTitle').value;
            const content = document.getElementById('studyContent').value;
            if (title && content) {
                const date = new Date().toLocaleString();
                studyContents[index] = {topic: studyContents[index].topic, title, content, date};
                localStorage.setItem('studyContents', JSON.stringify(studyContents));
                viewStudyContent(index);
            }
        }
    
        function deleteStudyContent(index) {
            if (confirm('정말로 이 학습 내용을 삭제하시겠습니까?')) {
                const topic = studyContents[index].topic;
                studyContents.splice(index, 1);
                localStorage.setItem('studyContents', JSON.stringify(studyContents));
                showStudyList(topic);
            }
        }
    
        function searchStudy(topic) {
            const searchTerm = document.getElementById('studySearchInput').value.toLowerCase();
            const results = studyContents.filter(item => 
                item.topic === topic && (item.title.toLowerCase().includes(searchTerm) || item.content.toLowerCase().includes(searchTerm))
            );
            let resultHtml = `<h3>${topic} 검색 결과</h3><ul>`;
            results.forEach((item, index) => {
                resultHtml += `<li onclick="viewStudyContent(${studyContents.indexOf(item)})">${item.title}</li>`;
            });
            resultHtml += '</ul>';
            document.getElementById('mainContent').innerHTML = resultHtml;
        }
    
        function showQnAList() {
            database.ref('posts').once('value').then((snapshot) => {
                let posts = snapshot.val();
                let listHtml = '<h3>Q&A 목록</h3><ul id="postList">';
                for (let key in posts) {
                    listHtml += `<li onclick="viewPost('${key}')">${posts[key].title}</li>`;
                }
                listHtml += '</ul>';
                document.getElementById('mainContent').innerHTML = listHtml;
            });
        }
    
        function showQnAForm() {
            document.getElementById('mainContent').innerHTML = `
                <h3>Q&A 글쓰기</h3>
                <input type="text" id="postTitle" placeholder="제목을 입력하세요">
                <textarea id="editor" placeholder="여기에 글을 작성하세요..."></textarea>
                <div class="button-container">
                    <button onclick="savePost()">저장</button>
                </div>
            `;
        }
    
        function savePost() {
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('editor').value;
            if (title && content) {
                const date = new Date().toLocaleString();
                const newPost = {title, content, date};
                database.ref('posts').push(newPost);
                showQnAList();
            }
        }
    
        function viewPost(key) {
            database.ref('posts/' + key).once('value').then((snapshot) => {
                const post = snapshot.val();
                let content = `
                    <h3>${post.title}</h3>
                    <div class="date-display">${post.date || '날짜 없음'}</div>
                    <p>${post.content}</p>
                    <div class="button-container">
                        <button onclick="editPost('${key}')">수정</button>
                        <button onclick="deletePost('${key}')">삭제</button>
                        <button onclick="showQnAList()">목록으로</button>
                    </div>
                `;
                document.getElementById('mainContent').innerHTML = content;
            });
        }
    
        function editPost(key) {
            database.ref('posts/' + key).once('value').then((snapshot) => {
                const post = snapshot.val();
                document.getElementById('mainContent').innerHTML = `
                    <h3>게시글 수정</h3>
                    <input type="text" id="editTitle" value="${post.title}">
                    <textarea id="editEditor">${post.content}</textarea>
                    <div class="button-container">
                        <button onclick="updatePost('${key}')">업데이트</button>
                        <button onclick="showQnAList()">취소</button>
                    </div>
                `;
            });
        }
    
        function updatePost(key) {
            const title = document.getElementById('editTitle').value;
            const content = document.getElementById('editEditor').value;
            if (title && content) {
                const date = new Date().toLocaleString();
                database.ref('posts/' + key).update({title, content, date});
                viewPost(key);
            }
        }
    
        function deletePost(key) {
            if (confirm('정말로 이 게시글을 삭제하시겠습니까?')) {
                database.ref('posts/' + key).remove();
                showQnAList();
            }
        }
    
        function searchQnA() {
            const searchTerm = document.getElementById('qnaSearchInput').value.toLowerCase();
            const results = posts.filter(post => 
                post.title.toLowerCase().includes(searchTerm) || 
                post.content.toLowerCase().includes(searchTerm)
            );
            let resultHtml = '<h3>Q&A 검색 결과</h3><ul>';
            results.forEach((post, index) => {
                resultHtml += `<li onclick="viewPost('${post.key}')">${post.title}</li>`;
            });
            resultHtml += '</ul>';
            document.getElementById('mainContent').innerHTML = resultHtml;
        }
    
        function showNoticeList() {
            let listHtml = '<h3>공지사항</h3><ul id="noticeList">';
            notices.forEach((notice, index) => {
                listHtml += `<li onclick="viewNotice(${index})">${notice.title}</li>`;
            });
            listHtml += '</ul>';
            listHtml += `
                <div class="search-container">
                    <input type="text" id="noticeSearchInput" placeholder="검색...">
                    <button onclick="searchNotice()">검색</button>
                </div>
                <div class="button-container">
                    <button onclick="showNoticePasswordForm()">공지사항 작성</button>
                </div>
            `;
            document.getElementById('mainContent').innerHTML = listHtml;
        }
    
        function showNoticePasswordForm() {
            document.getElementById('mainContent').innerHTML = `
                <h3>비밀번호 입력</h3>
                <input type="password" id="noticePassword" placeholder="비밀번호를 입력하세요">
                <div class="button-container">
                    <button onclick="checkNoticePassword()">확인</button>
                </div>
            `;
        }
    
        function checkNoticePassword() {
            const password = document.getElementById('noticePassword').value;
            if (password === '369369') {
                showNoticeForm();
            } else {
                alert('비밀번호가 올바르지 않습니다.');
            }
        }

        function showNoticeForm() {
            document.getElementById('mainContent').innerHTML = `
                <h3>공지사항 작성</h3>
                <input type="text" id="noticeTitle" placeholder="제목을 입력하세요">
                <textarea id="noticeContent" placeholder="내용을 입력하세요..."></textarea>
                <div class="button-container">
                    <button onclick="saveNotice()">저장</button>
                </div>
            `;
        }

        function saveNotice() {
            const title = document.getElementById('noticeTitle').value;
            const content = document.getElementById('noticeContent').value;
            if (title && content) {
                const date = new Date().toLocaleString();
                notices.push({title, content, date});
                localStorage.setItem('notices', JSON.stringify(notices));
                showNoticeList();
            } else {
                alert('제목과 내용을 모두 입력해주세요.');
            }
        }

        function viewNotice(index) {
            const notice = notices[index];
            let content = `
                <h3>${notice.title}</h3>
                <div class="date-display">${notice.date || '날짜 없음'}</div>
                <p>${notice.content}</p>
                <div class="button-container">
                    <button onclick="showNoticeList()">목록으로</button>
                    <button onclick="editNotice(${index})">수정</button>
                    <button onclick="deleteNotice(${index})">삭제</button>
                </div>
            `;
            document.getElementById('mainContent').innerHTML = content;
        }

        function editNotice(index) {
            const notice = notices[index];
            document.getElementById('mainContent').innerHTML = `
                <h3>공지사항 수정</h3>
                <input type="text" id="noticeTitle" value="${notice.title}">
                <textarea id="noticeContent">${notice.content}</textarea>
                <div class="button-container">
                    <button onclick="updateNotice(${index})">업데이트</button>
                    <button onclick="showNoticeList()">취소</button>
                </div>
            `;
        }

        function updateNotice(index) {
            const title = document.getElementById('noticeTitle').value;
            const content = document.getElementById('noticeContent').value;
            if (title && content) {
                const date = new Date().toLocaleString();
                notices[index] = {title, content, date};
                localStorage.setItem('notices', JSON.stringify(notices));
                viewNotice(index);
            }
        }

        function deleteNotice(index) {
            if (confirm('정말로 이 공지사항을 삭제하시겠습니까?')) {
                notices.splice(index, 1);
                localStorage.setItem('notices', JSON.stringify(notices));
                showNoticeList();
            }
        }

        function searchNotice() {
            const searchTerm = document.getElementById('noticeSearchInput').value.toLowerCase();
            const results = notices.filter(notice => 
                notice.title.toLowerCase().includes(searchTerm) || 
                notice.content.toLowerCase().includes(searchTerm)
            );
            let resultHtml = '<h3>공지사항 검색 결과</h3><ul>';
            results.forEach((notice, index) => {
                resultHtml += `<li onclick="viewNotice(${notices.indexOf(notice)})">${notice.title}</li>`;
            });
            resultHtml += '</ul>';
            document.getElementById('mainContent').innerHTML = resultHtml;
        }

        function showFileUpload() {
            document.getElementById('mainContent').innerHTML = `
                <h3>자료실</h3>
                <div class="button-container">
                    <button onclick="showFileUploadForm()">글쓰기</button>
                </div>
                <h3>업로드된 파일 목록</h3>
                <ul id="fileList"></ul>
            `;
            updateFileList();
        }

        function showFileUploadForm() {
            document.getElementById('mainContent').innerHTML = `
                <h3>파일 업로드</h3>
                <input type="text" id="fileTitle" placeholder="제목을 입력하세요">
                <textarea id="fileContent" placeholder="내용을 입력하세요..."></textarea>
                <input type="file" id="fileInput">
                <div class="button-container">
                    <button onclick="uploadFile()">업로드</button>
                </div>
            `;
        }

        function uploadFile() {
            const title = document.getElementById('fileTitle').value;
            const content = document.getElementById('fileContent').value;
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (title && content && file) {
                const date = new Date().toLocaleString();
                files.push({title, content, fileName: file.name, date});
                localStorage.setItem('files', JSON.stringify(files));
                showFileUpload();
            }
        }

        function updateFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            files.forEach((file, index) => {
                const li = document.createElement('li');
                li.textContent = file.title;
                li.onclick = () => viewFile(index);
                fileList.appendChild(li);
            });
        }

        function viewFile(index) {
            const file = files[index];
            let content = `
                <h3>${file.title}</h3>
                <div class="date-display">${file.date}</div>
                <div class="file-download">
                    <a href="#" onclick="downloadFile('${file.fileName}')">파일 다운로드</a>
                </div>
                <p>${file.content}</p>
            `;
            document.getElementById('mainContent').innerHTML = content;
        }

        function downloadFile(fileName) {
            // 실제 파일 다운로드 로직을 구현해야 합니다.
            // 이 예제에서는 단순히 알림을 표시합니다.
            alert(`${fileName} 다운로드를 시작합니다.`);
        }

        function pushState(content) {
            history.pushState({content: content}, "", "");
            document.getElementById('mainContent').innerHTML = content;
        }

        window.onpopstate = function(event) {
            if (event.state) {
                document.getElementById('mainContent').innerHTML = event.state.content;
            }
        };

        // 초기 페이지 로드
        showContent('이 홈페이지는 글쓰고, 올리고, 지울려고 만드는 사이트 입니다.');
    </script>
</body>
</html>

